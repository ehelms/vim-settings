---
- hosts: localhost
  tasks:
    - name: 'Install packages'
      become: yes
      package:
        name: "{{ item }}"
        state: 'present'
      with_items:
        - git
        - screen
        - vim
        - '@Development Tools'

    - name: 'Create symlinks'
      file:
        state: link
        src: "{{ playbook_dir }}/dotfiles/{{ item }}"
        dest: "{{ lookup('env', 'HOME') }}/{{ item }}"
        force: yes
      with_items:
        - .bashrc
        - .rdebugrc
        - .screenrc
        - .vimrc
        - .pryrc
        - .git-prompt.sh

    - name: 'Remove existing .vim directory'
      file:
        state: absent
        path: "{{ lookup('env', 'HOME') }}/.vim"

    - name: 'Create symlinks'
      file:
        state: link
        src: "{{ playbook_dir }}/vim"
        dest: "{{ lookup('env', 'HOME') }}/.vim"
        force: yes

    - name: 'Config git user.name'
      command: 'git config --global user.name "Eric D. Helms"'

    - name: 'Config git user.email'
      command: 'git config --global user.email ericdhelms@gmail.com'

    - name: 'Always push to github over ssh'
      become: yes
      git_config:
        name: 'url."git@github.com:".pushInsteadOf'
        value: 'https://github.com/'
        scope: system

    - name: 'Fetch vim.plug'
      command: "curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim"

    - name: 'Install vim plugins'
      shell: "vim +PlugInstall +qall"

    - name: 'Create directory structure'
      file:
        state: directory
        path: "{{ lookup('env', 'HOME') }}/{{ item }}"
      with_items:
        - workspace
        - workspace/upstream
        - workspace/downstream
